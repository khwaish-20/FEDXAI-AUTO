<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FEDXAI V4 Ultimate Cockpit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Rajdhani:wght@400;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            background-color: #020617;
            color: #e2e8f0;
            font-family: 'Rajdhani', sans-serif;
            background-image: radial-gradient(circle at 60% 50%, #1e293b 0%, #020617 70%);
            height: 100vh;
            overflow: hidden;
        }

        .font-hud {
            font-family: 'Orbitron', sans-serif;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(56, 189, 248, 0.15);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
        }

        .nav-btn.active {
            background: rgba(56, 189, 248, 0.1);
            color: #38bdf8;
            border-bottom: 2px solid #38bdf8;
        }

        /* Car Part Markers */
        .part-marker {
            position: absolute;
            width: 14px;
            height: 14px;
            background: #334155;
            border: 2px solid #94a3b8;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
        }

        .part-marker:hover {
            transform: scale(1.2);
            border-color: #fff;
        }

        .part-critical {
            background: #ef4444;
            border-color: #fee2e2;
            box-shadow: 0 0 15px #ef4444;
            animation: pulse-marker 1s infinite;
        }

        .ar-label {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid #ef4444;
            color: #ef4444;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Orbitron';
            font-size: 10px;
            white-space: nowrap;
            display: none;
            z-index: 20;
            transform: translateY(-35px) translateX(-50%);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .part-critical+.ar-label {
            display: block;
            animation: float-up 0.5s ease-out;
        }

        @keyframes pulse-marker {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }

            70% {
                transform: scale(1.5);
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        @keyframes float-up {
            from {
                opacity: 0;
                transform: translateY(-20px) translateX(-50%);
            }

            to {
                opacity: 1;
                transform: translateY(-35px) translateX(-50%);
            }
        }

        /* SVG Styling */
        .car-path {
            fill: none;
            stroke: #38bdf8;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            filter: drop-shadow(0 0 5px rgba(56, 189, 248, 0.5));
        }

        .car-fill {
            fill: rgba(30, 41, 59, 0.3);
        }

        .wheel {
            fill: none;
            stroke: #94a3b8;
            stroke-width: 2;
        }
    </style>
</head>

<body class="flex flex-col h-screen">

    <!-- Navbar -->
    <nav class="flex justify-between items-center px-4 py-3 border-b border-slate-800 bg-slate-950/90 z-50 h-14">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-bolt text-cyan-400 text-lg"></i>
            <h1 class="font-hud text-lg font-bold tracking-widest text-white">FEDXAI <span
                    class="text-cyan-400">EVO</span></h1>
        </div>

        <div class="flex gap-1 bg-slate-900 p-1 rounded-lg border border-slate-800">
            <button onclick="showPage('live')" id="nav-live"
                class="nav-btn active px-4 py-1 rounded text-xs font-bold tracking-wider text-slate-400 hover:text-white transition-all">
                <i class="fa-solid fa-gauge-high mr-2"></i> LIVE COCKPIT
            </button>
            <button onclick="showPage('health')" id="nav-health"
                class="nav-btn px-4 py-1 rounded text-xs font-bold tracking-wider text-slate-400 hover:text-white transition-all">
                <i class="fa-solid fa-clipboard-check mr-2"></i> HEALTH
            </button>
        </div>

        <div class="flex gap-2">
            <button onclick="startSimulation()"
                class="bg-slate-800 hover:bg-slate-700 text-cyan-400 px-3 py-1 rounded text-[10px] font-bold border border-slate-700">
                <i class="fa-solid fa-play mr-1"></i> TEST
            </button>
            <button onclick="connectBLE()" id="btn-conn"
                class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-1 rounded text-[10px] font-bold shadow-lg shadow-blue-500/20">
                CONNECT
            </button>
        </div>
    </nav>

    <!-- CONTENT AREA -->
    <div class="relative flex-1 overflow-hidden p-4">

        <!-- PAGE 1: LIVE COCKPIT (80/20 Split) -->
        <div id="page-live" class="h-full grid grid-cols-12 gap-4 transition-all duration-300">

            <!-- LEFT: CAR VISUALIZER (83% Width) -->
            <div
                class="col-span-10 glass-panel rounded-xl relative flex items-center justify-center bg-gradient-to-b from-slate-900/40 to-transparent overflow-hidden">
                <div class="absolute top-3 left-3 font-hud text-[10px] text-slate-500 tracking-widest">VEHICLE STATUS
                    MONITOR // ACTIVE</div>

                <!-- SVG CAR (High Visibility) -->
                <div class="relative w-[85%] h-full flex items-center justify-center">
                    <svg viewBox="0 0 600 250" class="w-full h-auto drop-shadow-[0_0_20px_rgba(56,189,248,0.2)]">
                        <!-- Detailed Sedan Outline -->
                        <path
                            d="M50,150 Q50,130 70,125 L150,110 L220,60 L400,60 L500,115 L560,125 Q580,130 580,150 L580,190 L530,190 A40,40 0 0,1 450,190 L180,190 A40,40 0 0,1 100,190 L50,190 Z"
                            class="car-path" fill="rgba(15,23,42,0.5)" />

                        <!-- Wheels -->
                        <circle cx="140" cy="190" r="35" class="wheel" />
                        <circle cx="490" cy="190" r="35" class="wheel" />

                        <!-- Window Line -->
                        <path d="M160,110 L230,70 L390,70 L490,115" class="car-path"
                            style="stroke-width:1; opacity:0.6" />
                    </svg>

                    <!-- COMPONENT MARKERS (Absolute Positioned on Container) -->
                    <!-- Engine (Front) -->
                    <div id="pt-engine" class="part-marker" style="top: 50%; left: 25%;"></div>
                    <div class="ar-label">ENGINE OVERHEAT</div>

                    <!-- Radiator (Front Nose) -->
                    <div id="pt-rad" class="part-marker" style="top: 55%; left: 12%;"></div>
                    <div class="ar-label">COOLANT LEAK</div>

                    <!-- Transmission (Center) -->
                    <div id="pt-trans" class="part-marker" style="top: 65%; left: 45%;"></div>
                    <div class="ar-label">GEAR SLIPPAGE</div>

                    <!-- Fuel Tank (Rear) -->
                    <div id="pt-fuel" class="part-marker" style="top: 55%; left: 80%;"></div>
                    <div class="ar-label">FUEL PUMP FAILURE</div>

                    <!-- Catalyst (Under Center) -->
                    <div id="pt-exh" class="part-marker" style="top: 75%; left: 50%;"></div>
                    <div class="ar-label">CATALYST EFFICIENCY</div>
                </div>

                <!-- ALERTS OVERLAY (Compact Bottom) -->
                <div id="live-alert-box"
                    class="absolute bottom-6 left-1/2 -translate-x-1/2 glass-panel border border-red-500/50 p-2 px-6 rounded-full bg-red-950/80 hidden flex items-center gap-3">
                    <i class="fa-solid fa-triangle-exclamation text-red-500 animate-pulse"></i>
                    <span class="font-hud text-red-400 font-bold text-sm" id="live-alert-msg">CRITICAL FAILURE
                        DETECTED</span>
                </div>
            </div>

            <!-- RIGHT: GAUGES STACK (17% Width) -->
            <div class="col-span-2 flex flex-col gap-3 h-full">

                <!-- MINI RPM (Compact) -->
                <div
                    class="glass-panel rounded-lg p-3 text-center relative overflow-hidden flex-1 flex flex-col justify-center">
                    <h3 class="text-slate-500 text-[9px] font-bold uppercase tracking-widest mb-1">RPM</h3>
                    <div class="font-hud text-3xl font-bold text-white mb-1" id="val-rpm">0</div>
                    <div class="text-[9px] text-cyan-400 font-mono">x1000</div>
                    <div class="mt-2 h-1 bg-slate-800 rounded-full w-full mx-auto">
                        <div id="bar-rpm" class="h-full bg-cyan-400 w-0 transition-all duration-300"></div>
                    </div>
                </div>

                <!-- Vertical Stats Stack -->
                <div class="glass-panel rounded-lg p-3 text-center flex-1 flex flex-col justify-center">
                    <h3 class="text-slate-500 text-[9px] font-bold uppercase mb-1">Temp</h3>
                    <div class="font-hud text-xl font-bold text-orange-400" id="val-ct">0°</div>
                    <div class="text-[8px] text-slate-400">deg C</div>
                </div>

                <div class="glass-panel rounded-lg p-3 text-center flex-1 flex flex-col justify-center">
                    <h3 class="text-slate-500 text-[9px] font-bold uppercase mb-1">Press</h3>
                    <div class="font-hud text-xl font-bold text-purple-400" id="val-fp">0.0</div>
                    <div class="text-[8px] text-slate-400">BAR</div>
                </div>

                <div class="glass-panel rounded-lg p-3 text-center flex-1 flex flex-col justify-center">
                    <h3 class="text-slate-500 text-[9px] font-bold uppercase mb-1">Prob</h3>
                    <div class="font-hud text-xl font-bold text-green-500" id="val-prob">0%</div>
                </div>

                <!-- Mini Chart -->
                <div class="h-24 glass-panel rounded-lg p-2 relative">
                    <canvas id="miniChart"></canvas>
                </div>
            </div>
        </div>

        <!-- PAGE 2: PREDICTIVE HEALTH REPORT (Unchanged) -->
        <div id="page-health" class="hidden h-full max-w-5xl mx-auto flex-col gap-6 pt-4">
            <div class="glass-panel rounded-2xl p-6 border-t-4 border-green-500 flex justify-between items-center"
                id="health-header">
                <div>
                    <h2 class="font-hud text-xl font-bold text-white mb-1">Prognostic Report</h2>
                    <p class="text-slate-400 text-xs">AI-driven RUL estimation (Remaining Useful Life).</p>
                </div>
                <div class="text-right">
                    <div class="font-hud text-4xl font-bold text-green-400" id="rul-score">98%</div>
                    <div class="text-[10px] text-slate-500 uppercase tracking-widest">Health Score</div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4 flex-1 overflow-y-auto">
                <!-- 1. Fuel -->
                <div class="glass-panel rounded-xl p-4 hover:bg-slate-800/40 transition-colors">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-slate-200 text-sm"><i
                                class="fa-solid fa-gas-pump mr-2 text-blue-400"></i>Fuel System</span>
                        <span class="text-green-400 font-hud text-xs" id="rul-fuel">6+ Months</span>
                    </div>
                    <div class="h-1 bg-slate-800 rounded-full overflow-hidden mb-1">
                        <div class="h-full bg-green-500 w-[95%]" id="bar-fuel"></div>
                    </div>
                    <p class="text-[10px] text-slate-500">Pressure stable at 3.5 Bar.</p>
                </div>

                <!-- 2. Cooling -->
                <div class="glass-panel rounded-xl p-4 hover:bg-slate-800/40 transition-colors">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-slate-200 text-sm"><i
                                class="fa-solid fa-temperature-full mr-2 text-orange-400"></i>Cooling</span>
                        <span class="text-green-400 font-hud text-xs" id="rul-cool">6+ Months</span>
                    </div>
                    <div class="h-1 bg-slate-800 rounded-full overflow-hidden mb-1">
                        <div class="h-full bg-green-500 w-[92%]" id="bar-cool"></div>
                    </div>
                    <p class="text-[10px] text-slate-500">Thermostat responsive.</p>
                </div>

                <!-- 3. Engine -->
                <div class="glass-panel rounded-xl p-4 hover:bg-slate-800/40 transition-colors">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-slate-200 text-sm"><i
                                class="fa-solid fa-gears mr-2 text-purple-400"></i>Engine</span>
                        <span class="text-green-400 font-hud text-xs" id="rul-eng">6+ Months</span>
                    </div>
                    <div class="h-1 bg-slate-800 rounded-full overflow-hidden mb-1">
                        <div class="h-full bg-green-500 w-[98%]" id="bar-eng"></div>
                    </div>
                    <p class="text-[10px] text-slate-500">Vibration nominal.</p>
                </div>

                <!-- 4. Catalyst -->
                <div class="glass-panel rounded-xl p-4 hover:bg-slate-800/40 transition-colors">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-slate-200 text-sm"><i
                                class="fa-solid fa-smog mr-2 text-slate-400"></i>Catalyst</span>
                        <span class="text-yellow-400 font-hud text-xs" id="rul-cat">4 Months</span>
                    </div>
                    <div class="h-1 bg-slate-800 rounded-full overflow-hidden mb-1">
                        <div class="h-full bg-yellow-500 w-[75%]" id="bar-cat"></div>
                    </div>
                    <p class="text-[10px] text-slate-500">Efficiency slightly reduced.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- PAGE NAV ---
        function showPage(pageId) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`nav-${pageId}`).classList.add('active');
            document.getElementById('page-live').classList.add('hidden');
            document.getElementById('page-health').classList.add('hidden');

            if (pageId === 'live') {
                document.getElementById('page-live').classList.remove('hidden');
                document.getElementById('page-live').classList.add('grid');
            } else {
                document.getElementById('page-health').classList.remove('hidden');
                document.getElementById('page-health').classList.add('flex');
            }
        }

        // --- CHART ---
        const ctx = document.getElementById('miniChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array(15).fill(''),
                datasets: [
                    { label: 'RPM', data: Array(15).fill(0), borderColor: '#22d3ee', borderWidth: 1.5, tension: 0.4, pointRadius: 0 },
                    { label: 'Temp', data: Array(15).fill(0), borderColor: '#f97316', borderWidth: 1.5, tension: 0.4, pointRadius: 0 }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { x: { display: false }, y: { display: false } },
                animation: false
            }
        });

        // --- STATE & UI ---
        let simInterval;

        function updateLiveUI(data) {
            document.getElementById('val-rpm').innerText = (data.rpm / 1000).toFixed(1); // x1000 format
            document.getElementById('val-ct').innerText = data.ct.toFixed(0) + '°';
            document.getElementById('val-fp').innerText = data.fp.toFixed(1);
            document.getElementById('bar-rpm').style.width = Math.min(100, (data.rpm / 80)) + '%';

            chart.data.datasets[0].data.push(data.rpm / 80);
            chart.data.datasets[1].data.push(data.ct);
            chart.data.datasets.forEach(ds => ds.data.shift());
            chart.update('none');
        }

        function triggerAlert(componentId, msg, isCritical) {
            document.querySelectorAll('.part-critical').forEach(el => el.classList.remove('part-critical'));
            document.getElementById('live-alert-box').classList.add('hidden');

            const probEl = document.getElementById('val-prob');
            if (isCritical) {
                probEl.innerText = (85 + Math.random() * 5).toFixed(0) + '%';
                probEl.className = "font-hud text-xl font-bold text-red-500 animate-pulse";

                if (componentId) document.getElementById(componentId).classList.add('part-critical');

                document.getElementById('live-alert-box').classList.remove('hidden');
                document.getElementById('live-alert-msg').innerText = msg;

                // Health Page Update
                document.getElementById('health-header').classList.replace('border-green-500', 'border-red-500');
                document.getElementById('rul-score').innerText = "CRITICAL";
                document.getElementById('rul-score').classList.replace('text-green-400', 'text-red-500');
                if (componentId === 'pt-fuel') updateHealthBar('fuel', 'IMMEDIATE', '5%', 'bg-red-500');
                if (componentId === 'pt-rad') updateHealthBar('cool', '1 Week', '15%', 'bg-red-500');

            } else {
                probEl.innerText = (2 + Math.random() * 3).toFixed(0) + '%';
                probEl.className = "font-hud text-xl font-bold text-green-500";

                document.getElementById('health-header').classList.replace('border-red-500', 'border-green-500');
                document.getElementById('rul-score').innerText = "98%";
                document.getElementById('rul-score').classList.replace('text-red-500', 'text-green-400');
                updateHealthBar('fuel', '6+ Months', '95%', 'bg-green-500');
                updateHealthBar('cool', '6+ Months', '92%', 'bg-green-500');
            }
        }

        function updateHealthBar(id, text, width, colorClass) {
            document.getElementById(`rul-${id}`).innerText = text;
            document.getElementById(`rul-${id}`).className = `font-hud text-xs ${colorClass.replace('bg-', 'text-')}`;
            document.getElementById(`bar-${id}`).className = `h-full w-full transition-all duration-1000 ${colorClass}`;
            document.getElementById(`bar-${id}`).style.width = width;
        }

        // --- DEMO MODE ---
        function startSimulation() {
            if (simInterval) clearInterval(simInterval);
            let t = 0;
            simInterval = setInterval(() => {
                t += 0.1;
                const rpm = 3000 + Math.sin(t) * 1200 + (Math.random() * 100);
                const ct = 90 + Math.sin(t * 0.5) * 5;
                const fp = 3.5 + Math.cos(t) * 0.2;
                updateLiveUI({ rpm, ct, fp });

                const cycle = Math.floor(t) % 25;
                if (cycle > 18 && cycle < 22) {
                    triggerAlert('pt-fuel', "FUEL PUMP EFFICIENCY LOW", true);
                    updateLiveUI({ rpm: rpm * 0.8, ct: ct, fp: 1.8 });
                } else if (cycle > 22) {
                    triggerAlert('pt-rad', "COOLANT TEMP CRITICAL", true);
                    updateLiveUI({ rpm: rpm, ct: 112, fp: fp });
                } else {
                    triggerAlert(null, "System OK", false);
                }
            }, 500);
        }

        // --- BLE LOGIC ---
        const SERVICE_UUID = '4fafc201-1fb5-459e-8fcc-c5c9c331914b';
        const CHAR_PROB_UUID = 'beb5483e-36e1-4688-b7f5-ea07361b26a9';
        const CHAR_ALERT_UUID = 'beb5483e-36e1-4688-b7f5-ea07361b26aa';
        const CHAR_SENSORS_UUID = 'beb5483e-36e1-4688-b7f5-ea07361b26ab';

        async function connectBLE() {
            clearInterval(simInterval);
            try {
                if (!navigator.bluetooth) throw new Error("Web Bluetooth API unavailable.");
                const device = await navigator.bluetooth.requestDevice({ filters: [{ name: 'FedXAI-Dongle' }], optionalServices: [SERVICE_UUID] });
                const server = await device.gatt.connect();
                const service = await server.getPrimaryService(SERVICE_UUID);

                const charSens = await service.getCharacteristic(CHAR_SENSORS_UUID);
                await charSens.startNotifications();
                charSens.addEventListener('characteristicvaluechanged', e => updateLiveUI(JSON.parse(new TextDecoder().decode(e.target.value))));

                const charProb = await service.getCharacteristic(CHAR_PROB_UUID);
                await charProb.startNotifications();
                charProb.addEventListener('characteristicvaluechanged', e => {
                    const prob = e.target.value.getFloat32(0, true);
                    if (prob > 0.5) triggerAlert('pt-engine', "Anomaly Detected", true);
                    else triggerAlert(null, "System OK", false);
                });

                const charAlert = await service.getCharacteristic(CHAR_ALERT_UUID);
                await charAlert.startNotifications();
                charAlert.addEventListener('characteristicvaluechanged', e => {
                    const msg = new TextDecoder().decode(e.target.value);
                    if (msg.includes("Fuel")) triggerAlert('pt-fuel', msg, true);
                    else if (msg.includes("Coolant")) triggerAlert('pt-rad', msg, true);
                    else triggerAlert(null, msg, false);
                });

                document.getElementById('btn-conn').innerText = "CONNECTED";
                document.getElementById('btn-conn').classList.replace("bg-blue-600", "bg-green-600");
            } catch (e) { alert("Connection Failed: " + e); }
        }
    </script>
</body>

</html>